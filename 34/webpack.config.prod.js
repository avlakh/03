"use strict";var path=require("path"),fs=require("fs"),_require=require("clean-webpack-plugin"),CleanWebpackPlugin=_require.CleanWebpackPlugin,CopyPlugin=require("copy-webpack-plugin"),HtmlWebpackPlugin=require("html-webpack-plugin"),MiniCssExtractPlugin=require("mini-css-extract-plugin"),CssMinimizerPlugin=require("css-minimizer-webpack-plugin"),TerserPlugin=require("terser-webpack-plugin");function generateHtmlPlugins(n){return fs.readdirSync(path.resolve(__dirname,n)).map(function(e){var i=e.split("."),s=i[0],r=i[1];return new HtmlWebpackPlugin({filename:"".concat(s,".html"),template:path.resolve(__dirname,"".concat(n,"/").concat(s,".").concat(r)),inject:!1})})}var htmlPlugins=generateHtmlPlugins("src/html/views"),config={entry:["./src/js/index.js","./src/scss/style.scss"],output:{path:path.resolve(__dirname,"dist"),filename:"js/bundle.js"},devServer:{port:9e3,hot:!0,liveReload:!0,watchFiles:["src/html/**/*.html"]},devtool:"source-map",mode:"production",optimization:{minimize:!0,minimizer:[new CssMinimizerPlugin({minimizerOptions:{preset:["default",{discardComments:{removeAll:!0}}]}}),new TerserPlugin({extractComments:!0})]},module:{rules:[{test:/\.(sass|scss)$/,include:path.resolve(__dirname,"src/scss"),use:[{loader:MiniCssExtractPlugin.loader,options:{}},{loader:"css-loader",options:{sourceMap:!0,url:!1}},{loader:"sass-loader",options:{implementation:require("sass"),sourceMap:!0}}]},{test:/\.html$/,include:path.resolve(__dirname,"src/html/includes"),use:["raw-loader"]}]},plugins:[new MiniCssExtractPlugin({filename:"css/style.bundle.css"}),new CopyPlugin({patterns:[{from:"src/fonts",to:"fonts"},{from:"src/favicon",to:"favicon"},{from:"src/img",to:"img"},{from:"src/uploads",to:"uploads"}]})].concat(htmlPlugins)};module.exports=function(e,i){return"production"===i.mode&&config.plugins.push(new CleanWebpackPlugin),config};